<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>History</title>
    <link rel="shortcut icon" href="/public/img/MFU.png" type="image/x-icon">
    <link rel="stylesheet" href="/public/css/staff/nav_bar_staff.css" />
    <link rel="stylesheet" href="/public/css/staff/history_staff.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* Notification Dropdown Style */
               .dropdown-fb {
            position: fixed;
            top: 75px;
            right: 40px;
            width: 350px;
            background: #ffffff;
            border: 2px solid #f7d86e;
            border-radius: 18px;
            box-shadow: 0 6px 24px #0002;
            z-index: 3000;
            display: none;
            font-family: 'Segoe UI', Arial, sans-serif;
            transition: box-shadow 0.2s;
        }
        .dropdown-fb.show {
            display: block !important;
        }
        .dropdown-fb-header {
            padding: 16px 20px 8px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #fae3a1;
        }
        .dropdown-fb-header .btn-link {
            background: none;
            border: none;
            color: #1976d2;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: underline;
        }
        .dropdown-fb-tabs {
            display: flex;
            padding: 8px 20px;
            gap: 10px;
            border-bottom: 1px solid #fae3a1;
        }
        .fb-tab {
            padding: 7px 22px;
            border-radius: 20px;
            border: none;
            background: #f7e7b9;
            font-weight: 500;
            color: #25408f;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s, color 0.2s;
        }
        .fb-tab.active {
            background: #25408f;
            color: #fff;
            font-weight: bold;
        }
        .dropdown-fb-list {
            list-style: none;
            margin: 0;
            padding: 0;
            max-height: 340px;
            overflow-y: auto;
        }
        .fb-noti-item {
            display: flex;
            flex-direction: column;
            gap: 3px;
            padding: 16px 22px 14px 22px;
            border-bottom: 1px solid #f7e7b9;
            background: #fffbe9;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }
        .fb-noti-item.unread {
            background: #fff9e1;
        }
        .fb-noti-item.read {
            background: #f3f2f2;
            color: #aaa;
        }
        .fb-noti-top {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .fb-noti-icon {
            font-size: 1.6rem;
            margin-right: 2px;
        }
        .fb-noti-title {
            font-weight: bold;
            font-size: 1.08rem;
            flex: 1;
        }
        .fb-noti-dot {
            width: 11px;
            height: 11px;
            background: #1976d2;
            border-radius: 50%;
            margin-left: 7px;
            margin-right: 2px;
            display: inline-block;
        }
        .fb-noti-date {
            font-size: 0.96rem;
            color: #888;
            margin-bottom: 2px;
        }
        .fb-noti-msg {
            font-size: 0.97rem;
            color: #444;
            margin-bottom: 1px;
        }
        .dropdown-fb-footer {
            padding: 12px 0;
            text-align: center;
            border-top: 1px solid #fae3a1;
            background: #fffbe9;
        }
        .fb-seeall {
            background: none;
            border: none;
            color: #1976d2;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: underline;
        }
        #notificationBtn .badge {
            font-size: 1rem;
            top: 2px;
            left: 22px;
            padding: 0 6px;
        }
    </style>
</head>

<body>
    <div id="navbar"></div>
    <div class="d-flex" style="flex: 1;">
        <div id="sidebar"></div>
        <div class="main-content">
            <div class="container" id="main-content-area">
                <div id="loading-overlay">
                    <div class="loader-content">
                        <div class="loading-icon" style="background-image: url('/public/img/loader-hourglass.svg');">
                        </div>
                        <div class="loading-text">Loading...</div>
                    </div>
                </div>
                <div class="container py-5 mt-5">
                    <h2>History</h2>
                    <div class="d-flex align-items-center gap-4 mt-3" style="max-width: 900px;">
                        <div class="d-flex flex-column" style="width: 180px;">
                            <label for="dormitory" class="form-label mb-1"
                                style="font-weight: 500; font-size: 0.85rem;">Dormitory</label>
                            <select class="form-select form-select-sm" id="dormitory">
                                <option value="">All Dormitories</option>
                                <option value="Lamduan 7" selected>Lamduan 7</option>
                                <option value="Lamduan 6">Lamduan 6</option>
                                <option value="Lamduan 5">Lamduan 5</option>
                                <option value="Lamduan 4">Lamduan 4</option>
                                <option value="Lamduan 3">Lamduan 3</option>
                                <option value="Lamduan 2">Lamduan 2</option>
                                <option value="Lamduan 1">Lamduan 1</option>
                            </select>
                        </div>
                        <div class="d-flex flex-column" style="width: 180px;">
                            <label for="date" class="form-label mb-1"
                                style="font-weight: 500; font-size: 0.85rem;">Date</label>
                            <div class="input-group input-group-sm">
                                <input type="date" class="form-control" id="date" />
                                <span class="input-group-text"></span>
                            </div>
                        </div>
                    </div>
                    <!-- Search by Section -->
                    <div class="search-type-section d-flex align-items-end gap-2 mt-3">
                        <label class="form-label mb-0"
                            style="font-weight: 500; font-size: 0.85rem; min-width:75px;">Search
                            by</label>
                        <div id="search-type-btn-group" class="search-type-btn-group">
                            <button class="search-type-btn active" data-type="all" type="button">All</button>
                            <button class="search-type-btn" data-type="article" type="button">Item</button>
                            <button class="search-type-btn" data-type="nameroom" type="button">Name or Room
                                Number</button>
                            <button class="search-type-btn" data-type="technician" type="button">Technician</button>
                        </div>
                        <!-- REPAIR TYPE DROPDOWN moved here -->
                        <select class="repairtype-select ms-2" id="repairtype-dropdown" name="repairtype"
                            style="width: 180px;">
                            <option value="">All Repair Types</option>
                        </select>
                        <div id="search-bar-wrapper" class="flex-grow-1 show-all ms-2">
                            <div id="search-bar-input-area">
                                <div class="search-input-area search-input-all">
                                    <div class="input-group input-group-sm shadow-sm rounded"
                                        style="background: #F5F5F5;">
                                        <input type="search" class="form-control border-0" id="search-all"
                                            placeholder="Search anything..." autocomplete="off" />
                                        <span class="input-group-text bg-transparent border-0">
                                            <i class="fa-solid fa-magnifying-glass"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="search-input-area search-input-article">
                                    <div class="input-group input-group-sm shadow-sm rounded"
                                        style="background: #F5F5F5;">
                                        <input type="search" class="form-control border-0" id="search-article"
                                            placeholder="Search Item..." autocomplete="off" />
                                        <span class="input-group-text bg-transparent border-0">
                                            <i class="fa-solid fa-magnifying-glass"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="search-input-area search-input-nameroom">
                                    <div class="input-group input-group-sm shadow-sm rounded"
                                        style="background: #F5F5F5;">
                                        <input type="search" class="form-control border-0" id="search-nameroom"
                                            placeholder="Search Name, Room Number or Student ID..."
                                            autocomplete="off" />
                                        <span class="input-group-text bg-transparent border-0">
                                            <i class="fa-solid fa-magnifying-glass"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="search-input-area search-input-technician">
                                    <div class="input-group input-group-sm shadow-sm rounded"
                                        style="background: #F5F5F5;">
                                        <input type="search" class="form-control border-0" id="search-technician"
                                            placeholder="Search Technician Name..." autocomplete="off" />
                                        <span class="input-group-text bg-transparent border-0">
                                            <i class="fa-solid fa-magnifying-glass"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="card-container" class="d-flex flex-column gap-4 mt-4"></div>
                </div>
            </div>
        </div>
<script>
let currentSearchType = 'all';

// Loader functions
function showLoaderContent() {
    const overlay = document.getElementById('loading-overlay');
    overlay.style.display = 'flex';
    overlay.innerHTML = '';
    fetch('/loading')
        .then(res => res.text())
        .then(html => {
            overlay.innerHTML = `<div class="loader-content">${html}</div>`;
            overlay.style.background = '#fffbe9';
        });
}
function hideLoaderContent() {
    const overlay = document.getElementById('loading-overlay');
    overlay.style.display = 'none';
    overlay.innerHTML = '';
}

// ✅ ใช้โค้ด notification แบบ dashboard
function setupNotificationDropdown() {
    let allNotifications = [];
    let filterType = "all";

    const notificationBtn = document.getElementById("notificationBtn");
    const notificationDropdown = document.getElementById("notificationDropdown");
    const notificationCount = document.getElementById("notificationCount");
    const notificationList = document.getElementById("notificationList");
    const markAllAsReadBtn = document.getElementById("markAllAsReadBtn");
    const allNotiBtn = document.getElementById("allNotiBtn");
    const unreadNotiBtn = document.getElementById("unreadNotiBtn");

    if (!notificationBtn || !notificationDropdown) return;

    // Toggle dropdown
    notificationBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        notificationDropdown.classList.toggle("show");
        renderNotifications();
    });

    // Close dropdown
    document.addEventListener("click", (e) => {
        if (!notificationDropdown.contains(e.target) && !notificationBtn.contains(e.target)) {
            notificationDropdown.classList.remove("show");
        }
    });

    function formatDateDMYHM(dateStr) {
        const d = new Date(dateStr);
        const day = String(d.getDate()).padStart(2, '0');
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const year = d.getFullYear();
        let hour = d.getHours();
        let min = String(d.getMinutes()).padStart(2, '0');
        let ampm = "AM";
        if (hour >= 12) {
            ampm = "PM";
            if (hour > 12) hour -= 12;
        }
        if (hour === 0) hour = 12;
        return `${day}/${month}/${year} ${hour}:${min} ${ampm}`;
    }

    function renderNotifications() {
        notificationList.innerHTML = "";
        let filtered = (filterType === "unread")
            ? allNotifications.filter(n => n.is_read === 0)
            : allNotifications;

        if (filtered.length === 0) {
            notificationList.innerHTML = `<li class="px-3 py-2 text-muted small">No notifications</li>`;
            return;
        }

        filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

        filtered.forEach(noti => {
            const li = document.createElement("li");
            li.className =
                "px-3 py-2 small border-bottom cursor-pointer " +
                (noti.is_read === 0
                    ? "bg-warning-subtle text-dark"
                    : "bg-white text-muted");

            li.innerHTML = `
                <div class="fw-bold">${noti.title || ""}</div>
                <div class="fw-normal">${noti.message || ""}</div>
                <div class="small text-secondary">${formatDateDMYHM(noti.created_at)}</div>
            `;

            li.addEventListener("click", async () => {
                if (noti.link) window.location.href = noti.link;
                await fetch("/admin/notifications/read", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ notification_id: noti.notification_id })
                });
                noti.is_read = 1;
                renderNotifications();
                updateNotificationCount();
            });

            notificationList.appendChild(li);
        });
    }

    async function fetchNotifications() {
        try {
            const res = await fetch("/admin/notifications");
            if (!res.ok) throw new Error("Failed to fetch");
            const data = await res.json();
            allNotifications = data;
            renderNotifications();
            updateNotificationCount();
        } catch (err) {
            console.error(err);
        }
    }

    function updateNotificationCount() {
        const unread = allNotifications.filter(n => n.is_read === 0).length;
        if (unread > 0) {
            notificationCount.textContent = unread;
            notificationCount.classList.remove("d-none");
        } else {
            notificationCount.classList.add("d-none");
        }
    }

    markAllAsReadBtn.addEventListener("click", async function () {
        try {
            await fetch('/admin/notifications/read-all', {
                method: 'POST',
                credentials: 'include'
            });
            await fetchNotifications();
        } catch (e) {
            console.error(e);
        }
    });

    allNotiBtn.addEventListener("click", function () {
        filterType = "all";
        allNotiBtn.classList.add("active");
        unreadNotiBtn.classList.remove("active");
        renderNotifications();
    });

    unreadNotiBtn.addEventListener("click", function () {
        filterType = "unread";
        allNotiBtn.classList.remove("active");
        unreadNotiBtn.classList.add("active");
        renderNotifications();
    });

    fetchNotifications();
    setInterval(fetchNotifications, 30000);
}

window.addEventListener("DOMContentLoaded", () => {
    showLoaderContent();

    const repairTypePromise = fetch('/admin/api/repairtypes')
        .then(res => res.json())
        .then(data => {
            const dropdown = document.getElementById('repairtype-dropdown');
            dropdown.innerHTML = '<option value="">All Repair Types</option>';
            data.forEach(type => {
                const opt = document.createElement('option');
                opt.value = type;
                opt.textContent = type;
                dropdown.appendChild(opt);
            });
        });

    const dormPromise = fetch('/admin/api/dormitories')
        .then(res => res.json())
        .then(dorms => {
            const dormSel = document.getElementById('dormitory');
            dormSel.innerHTML = '<option value="">All Dormitories</option>';
            dorms.forEach(d => {
                dormSel.innerHTML += `<option value="${d.dorm_name}">${d.dorm_name}</option>`;
            });
        });

    const navbarPromise = fetch('/admin/sidebar')
        .then(res => res.text())
        .then(data => {
            const temp = document.createElement('div');
            temp.innerHTML = data;

            const navbar = temp.querySelector('.navbar');
            const tabs = temp.querySelector('.tabs');
            const logoutModal = temp.querySelector('#logoutModal');
            const notificationDropdown = temp.querySelector('#notificationDropdown');

            if (navbar) document.getElementById('navbar').appendChild(navbar);
            if (tabs) document.getElementById('sidebar').appendChild(tabs);
            if (logoutModal) document.body.appendChild(logoutModal);
            if (notificationDropdown) document.body.appendChild(notificationDropdown);

            window.toggleSidebar = function () {
                document.querySelector(".tabs").classList.toggle("collapsed");
                document.body.classList.toggle("sidebar-collapsed");
            };
            window.showLogoutModal = function () {
                const modal = new bootstrap.Modal(document.getElementById('logoutModal'));
                modal.show();
            };
            window.handleLogout = function () {
                window.location.href = "/login";
            };
            const currentPath = window.location.pathname;
            document.querySelectorAll('.tab-item').forEach(item => {
                const href = item.getAttribute('href');
                if (href && currentPath.startsWith(href)) item.classList.add('active');
            });

            // ✅ เรียกใช้ notification logic แบบ dashboard
            setTimeout(() => setupNotificationDropdown(), 300);
        });

    Promise.all([repairTypePromise, dormPromise, navbarPromise]).then(() => {
        setTimeout(() => {
            hideLoaderContent();
            loadHistoryReports();
        }, 1000);
    });

    // Filter events
    document.getElementById('dormitory').addEventListener('change', loadHistoryReports);
    document.getElementById('date').addEventListener('change', loadHistoryReports);
    document.getElementById('repairtype-dropdown').addEventListener('change', loadHistoryReports);

    // Search type buttons
    const btnGroup = document.getElementById('search-type-btn-group');
    const searchBarWrapper = document.getElementById('search-bar-wrapper');
    btnGroup.addEventListener('click', function (e) {
        const btn = e.target.closest('.search-type-btn');
        if (!btn) return;
        btnGroup.querySelectorAll('.search-type-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentSearchType = btn.dataset.type;
        searchBarWrapper.className = "flex-grow-1 " +
            (currentSearchType === "all" ? "show-all" :
                currentSearchType === "article" ? "show-article" :
                    currentSearchType === "technician" ? "show-technician" : "show-name-room");
        setTimeout(() => {
            if (currentSearchType === 'all') {
                document.getElementById('search-all').focus();
            } else if (currentSearchType === 'article') {
                document.getElementById('search-article').focus();
            } else if (currentSearchType === 'nameroom') {
                document.getElementById('search-nameroom').focus();
            } else if (currentSearchType === 'technician') {
                document.getElementById('search-technician').focus();
            }
        }, 100);
        loadHistoryReports();
    });

    // Search input listeners
    document.getElementById('search-bar-input-area').addEventListener('input', function (e) {
        if (e.target.id === 'search-all' && currentSearchType === 'all') {
            loadHistoryReports();
        } else if (e.target.id === 'search-article' && currentSearchType === 'article') {
            loadHistoryReports();
        } else if (e.target.id === 'search-nameroom' && currentSearchType === 'nameroom') {
            loadHistoryReports();
        } else if (e.target.id === 'search-technician' && currentSearchType === 'technician') {
            loadHistoryReports();
        }
    });
});

function generateStars(score) {
    const rating = parseInt(score);
    if (isNaN(rating)) return "No feedback";
    let stars = "";
    for (let i = 1; i <= 5; i++) {
        stars += i <= rating
            ? '<i class="fa-solid fa-star" style="color: #ffc107;"></i>'
            : '<i class="fa-regular fa-star" style="color: #ccc;"></i>';
    }
    return stars;
}

function loadHistoryReports() {
    const dormName = document.getElementById('dormitory').value;
    const date = document.getElementById('date').value;
    const repairtype = document.getElementById('repairtype-dropdown').value;

    let url = '/admin/api/history?dormName=' + encodeURIComponent(dormName);
    if (date) url += '&date=' + encodeURIComponent(date);
    if (repairtype) url += '&repairtype=' + encodeURIComponent(repairtype);

    fetch(url)
        .then(res => {
            if (!res.ok) throw new Error('No history found.');
            return res.json();
        })
        .then(data => {
            renderHistoryCards(data);
        })
        .catch(err => {
            document.getElementById("card-container").innerHTML =
                `<div class="alert alert-info">${err.message}</div>`;
        });
}

function renderHistoryCards(reports) {
    const container = document.getElementById("card-container");
    container.innerHTML = "";

    let search = "";
    if (currentSearchType === "all") {
        search = document.getElementById('search-all').value.trim().toLowerCase();
        if (search) {
            reports = reports.filter(report => {
                const concat = [
                    report.student_name || '',
                    report.dorm || '',
                    report.room_number || '',
                    report.category || '',
                    report.article || '',
                    report.description || '',
                    report.technician_name || '',
                    report.technician_phone || '',
                    report.status || '',
                    report.feedback_comment || '',
                    report.comment || '',
                    report.work_description || ''
                ].join(' ').toLowerCase();
                return concat.includes(search);
            });
        }
    } else if (currentSearchType === "article") {
        search = document.getElementById('search-article').value.trim().toLowerCase();
        if (search) {
            reports = reports.filter(report =>
                (report.article || '').toLowerCase().includes(search)
            );
        }
    } else if (currentSearchType === "nameroom") {
        search = document.getElementById('search-nameroom').value.trim().toLowerCase();
        if (search) {
            reports = reports.filter(report =>
                (report.student_name || '').toLowerCase().includes(search) ||
                (report.room_number || '').toLowerCase().includes(search) ||
                (report.student_id || '').toLowerCase().includes(search)
            );
        }
    } else if (currentSearchType === "technician") {
        search = document.getElementById('search-technician').value.trim().toLowerCase();
        if (search) {
            reports = reports.filter(report =>
                (report.technician_name || '').toLowerCase().includes(search)
            );
        }
    }

    if (!reports || reports.length === 0) {
        container.innerHTML = '<div class="alert alert-info">No completed or cancelled repair requests were found.</div>';
        return;
    }

    reports.forEach(report => {
        const isCanceled = report.status && report.status.toLowerCase() === "cancel";
        const isCompleted = report.status && report.status.toLowerCase() === "completed";
        if (!isCanceled && !isCompleted) return;

        let imageSrc = report.image || '';
        if (imageSrc && imageSrc.startsWith('uploads/')) {
            imageSrc = '/public/' + imageSrc;
        }
        if (!imageSrc) {
            imageSrc = '/public/img/no-image.png';
        }

        const feedbackScore = report.feedback_score || report.rating;
        const feedbackComment = report.feedback_comment || report.comment;
        const technicianName = report.technician_name || '-';
        const technicianPhone = report.technician_phone || report.phone_number || '-';
        const headTechName = report.headtech_name || "-";

        const card = document.createElement("div");
        card.className = "card shadow-sm mx-auto";
        card.style.background = "#e9e9e9";
        card.style.borderRadius = "15px";
        card.style.padding = "20px";
        card.style.width = "1100px";

        const statusColor = isCanceled ? "#dc3545" : "#30BD71";

        card.innerHTML = `
        <div class="row align-items-start" style="font-size: 0.85rem; line-height: 1.8;">
            <div class="col-4 d-flex justify-content-center align-items-center">
                <img src="${imageSrc}" alt="Image"
                     style="width: 100%; border-radius: 12px; max-height: 250px; object-fit: cover;">
            </div>
            <div class="col-3 d-flex flex-column justify-content-start">
                <p class="mb-1"><strong>Name:</strong> ${report.student_name || '-'}</p>
                <p class="mb-1"><strong>Dormitory:</strong> ${report.dorm || '-'}</p>
                <p class="mb-1"><strong>Room:</strong> ${report.room_number || '-'}</p>
                <p class="mb-1"><strong>Request Date:</strong> ${formatDate(report.request_date)}</p>
                ${isCompleted ? `<p class="mb-1"><strong>Repair Date:</strong> ${formatDate(report.repair_date) || "-"}</p>` : ""}
                ${isCompleted ? `<p class="mb-1"><strong>Completed Date:</strong> ${formatDate(report.complete_date) || "-"}</p>` : ""}
                ${isCompleted && feedbackScore ? `<p class="mb-1"><strong>Feedback:</strong> ${generateStars(feedbackScore)}</p>` : ""}
                ${isCompleted && feedbackComment ? `<p class="mb-1"><strong>Comment:</strong> ${feedbackComment}</p>` : ""}
            </div>
            <div class="col-5 d-flex flex-column justify-content-start">
                ${isCompleted && headTechName !== '-' ? `<p class="mb-1"><strong>Assigned By:</strong> ${headTechName}</p>` : ""}
                ${isCompleted && technicianName !== '-' ? `<p class="mb-1"><strong>Technician:</strong> ${technicianName}</p>` : ""}
                ${isCompleted && technicianPhone !== '-' ? `<p class="mb-1"><strong>Phone:</strong> ${technicianPhone}</p>` : ""}
                <p class="mb-1"><strong>Repair Type:</strong> ${report.category || '-'}</p>
                <p class="mb-1"><strong>Item:</strong> ${report.article || '-'}</p>
                <p class="mb-1"><strong>Damage Description:</strong> ${report.description || '-'}</p>
                ${isCompleted && report.work_description ? `<p class="mb-1"><strong>Work Description:</strong> ${report.work_description}</p>` : ""}
                <div class="mt-3">
                    <span style="display: inline-block; background-color: ${statusColor}; color: white; font-weight: 600; border-radius: 20px; padding: 6px 20px; width: 150px; text-align: center;">
                        ${report.status}
                    </span>
                </div>
            </div>
        </div>
    `;
        container.appendChild(card);
    });
}

function formatDate(dateStr) {
    if (!dateStr) return '-';
    const date = new Date(dateStr);
    if (isNaN(date)) return dateStr;
    let hours = date.getHours();
    const minutes = date.getMinutes().toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const year = date.getFullYear();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12;
    const hourStr = hours.toString().padStart(2, '0');
    return `${day}/${month}/${year}, ${hourStr}:${minutes} ${ampm}`;
}
</script>

</body>

</html>