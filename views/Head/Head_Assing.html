<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/views/Head/Navbar2/Nav2.css">
    <link rel="stylesheet" href="/public/css/Head/assing.css">
    <link rel="shortcut icon" href="/public/img/MFU.png" type="image/x-icon">
    <title>Assign work</title>
</head>

<body>
    <div id="navbar-placeholder"></div>
    <div class="container mt-5 pt-4 " id="main-content">
        <h4 class="mb-4 fw-bold">Repair Task Assignment</h4>
        <!-- Requester Information -->
        <div class=" mb-4 rounded" style="background-color: #faf3e0;">
            <div class="rounded-top px-3 py-2 text-white fw-bold" style="background-color: #C9454A;">
                Requester Information
            </div>
            <div class=" row p-3">
                <div class="col-12 col-md-3 mb-3">
                    <label class="form-label fw-semibold">Request Date :</label>
                    <input id="request_date" type="date" class="form-control" readonly />
                </div>
                <div class="col-12 col-md-3 mb-3">
                    <label class="form-label fw-semibold">Dormitory :</label>
                    <input id="dorm" type="text" class="form-control" readonly />
                </div>
                <div class="col-12 col-md-3 mb-3">
                    <label class="form-label fw-semibold">Requester's Name :</label>
                    <input id="reporter_name" type="text" class="form-control" readonly />
                </div>
                <div class="col-12 col-md-3 mb-3">
                    <label class="form-label fw-semibold">Room Number :</label>
                    <input id="room_number" type="text" class="form-control" readonly />
                </div>
            </div>
        </div>

        <!-- Issue Information -->
        <div class="p-0 mb-4 rounded" style="background-color: #faf3e0;">
            <div class="rounded-top px-3 py-2 text-white fw-bold" style="background-color: #C9454A;">
                Issue Information
            </div>
            <div class="row m-0 p-3">
                <div class="col-md-3 text-center mb-3">
                    <img id="issue_image" src="" alt="Issue Image" class="img-fluid rounded" style="max-height: 250px;">
                </div>
                <div class="col-md-9">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Repair Type :</label>
                        <input id="repair_type" type="text" class="form-control" readonly />
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Item :</label>
                        <input id="article" type="text" class="form-control" readonly />
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Damage Description :</label>
                        <input id="description" type="text" class="form-control" readonly />
                    </div>
                </div>
            </div>
        </div>

        <!-- Assigned Technician -->
        <div class="p-0 mb-4 rounded" style="background-color:  #faf3e0;">
            <h5 class="rounded-top px-3 py-2 text-white fw-bold" style="background-color: #C9454A;">Assigned Technician
            </h5>
            <div class="px-3 py-3">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Repair Date:</label>
                        <input id="repair_date_assign" type="date" class="form-control" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Technician :</label>
                        <select id="technician" class="form-select"></select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Time:</label>
                        <div class="input-group">
                            <input id="repair_time" type="time" class="form-control" step="1800" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Phone number :</label>
                        <input id="technician_phone" type="text" class="form-control" readonly />
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex flex-column flex-sm-row justify-content-end gap-2">
            <button class="btn btn-success" onclick="assignRequest()">Confirm</button>
            <button class="btn btn-danger px-2 rounded-sm" data-bs-toggle="modal"
                data-bs-target="#cancelModal">Cancel</button>
        </div>
    </div>
    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered text-center">
            <div class="modal-content py-4">
                <div class="text-success fs-1"><i class="bi bi-hand-thumbs-up-fill"></i></div>
                <div class="modal-body">
                    <h5 class="fw-bold">Success</h5>
                    <p>The task has been successfully assigned to the technician.</p>
                    <button type="button" class="btn btn-success px-4" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cancel Confirmation Modal -->
    <div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-3">
                <div class="text-center">
                    <div class="text-danger fs-1"><i class="bi bi-exclamation-triangle-fill"></i></div>
                    <h5 class="fw-bold">Are You Sure?</h5>
                    <p class="text-muted">Do you really want to cancel assigning this task?<br>After canceling, you will
                        not
                        be able to undo this action.</p>
                    <div class="d-flex justify-content-center gap-2">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-danger" onclick="handleCancel()">Yes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="formAlertModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Warning</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="alert-msg"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/public/js/Head/Head_Assign.js"></script>
        <script src="/public/js/Head/navbar-notification.js"></script>
    <script>
        fetch('/views/Head/Navbar2/Navbar2.html')
            .then(res => res.text())
            .then(data => {
                 document.getElementById('navbar-placeholder').innerHTML = data;
                const navbarPlaceholder = document.getElementById('navbar-placeholder');
                navbarPlaceholder.innerHTML = data;
                const mobileMenuToggle = navbarPlaceholder.querySelector('.mobile-menu-toggle');
                const sidebar = navbarPlaceholder.querySelector('.sidebar');
                if (mobileMenuToggle && sidebar) {
                    mobileMenuToggle.addEventListener('click', function () {
                        sidebar.classList.toggle('open');
                        document.body.classList.toggle('sidebar-open');
                    });
                }
                navbarPlaceholder.querySelectorAll('.dropdown-toggle').forEach(dropdownToggleEl => {
                    new bootstrap.Dropdown(dropdownToggleEl);
                });
                const logoutBtn = document.getElementById('logoutLink');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function (e) {
                        e.preventDefault();
                        const modal = new bootstrap.Modal(document.getElementById('logoutConfirmModal'));
                        modal.show();
                    });
                }
                const confirmLogoutBtn = document.getElementById('confirmLogoutBtn');
                if (confirmLogoutBtn) {
                    confirmLogoutBtn.addEventListener('click', function () {
                        fetch('/logout', { method: 'POST', credentials: 'include' })
                            .then(() => window.location.href = '/login')
                            .catch(() => window.location.href = '/login');
                    });
                }
                const currentPath = window.location.pathname;
                const sidebarLinks = navbarPlaceholder.querySelectorAll('.sidebar .menu li a');
                sidebarLinks.forEach(link => {
                    const linkPath = link.pathname.replace(/^\/|\/$/g, '');
                    const currentPathNormalized = currentPath.replace(/^\/|\/$/g, '');
                    if (currentPathNormalized.includes(linkPath) && linkPath !== '') {
                        link.parentElement.classList.add('active');
                    } else if (currentPathNormalized === '' && linkPath === 'Head_Dashboard.html') {
                        link.parentElement.classList.add('active');
                    }
                });
            });
        function handleConfirm() {
            const modal = new bootstrap.Modal(document.getElementById('successModal'));
            modal.show();
            setTimeout(() => {
                window.location.href = 'Head_Requestlist.html';
            }, 1500);
        }

    </script>
</body>

</html>